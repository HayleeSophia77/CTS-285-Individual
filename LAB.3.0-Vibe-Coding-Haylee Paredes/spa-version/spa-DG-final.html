<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Dice Game — Forced Dark (Single Line • No Scroll)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{
    color-scheme: dark;
    --bg:#0d1225; --text:#e9edff; --muted:#a9b2d7;
    --card:#111936; --border:#2a3560; --accent:#7ea0ff;
    --shadow: 0 12px 34px rgba(0,0,0,.55);

    /* Dice (dark) */
    --die-face:#0c142c; --die-border:#ffffff; --pip:#ffffff;

    /* Table mat */
    --mat:#0a0f24; --mat-grid: rgba(255,255,255,.08);

    /* Controls (dark) */
    --ctrl-bg:#101523; --ctrl-text:#f2f5ff; --ctrl-border:#7ea0ff; --ctrl-focus:#ffd166;
  }

  *{box-sizing:border-box}
  body{margin:0; font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif; color:var(--text); background:var(--bg)}
  .wrap{max-width:920px; margin: clamp(14px,3vw,36px) auto; padding: 0 16px}
  header{display:flex; justify-content:space-between; align-items:center; gap:10px; margin-bottom:12px}
  h1{margin:0; font-size:clamp(1.4rem,3vw,2rem)}
  .sub{color:var(--muted); font-size:.95rem}
  nav{display:flex; gap:8px; flex-wrap:wrap}
  nav a{padding:.5rem .85rem; border:1px solid var(--border); border-radius:12px; background:var(--card); text-decoration:none; color:inherit; box-shadow:var(--shadow)}
  nav a.active{outline:2px solid var(--accent)}
  main{border:1px solid var(--border); background:var(--card); border-radius:16px; padding:16px; box-shadow:var(--shadow)}
  .screen{display:none} .screen.active{display:block}
  #live{position:absolute; left:-9999px; width:1px; height:1px; overflow:hidden}

  /* ---- TABLE MAT ---- */
  .mat{
    margin: 10px 0 0; border-radius: 16px; padding: 22px;
    background:
      linear-gradient(0deg, transparent 24%, var(--mat-grid) 25%, var(--mat-grid) 26%, transparent 27%, transparent 74%, var(--mat-grid) 75%, var(--mat-grid) 76%, transparent 77%),
      linear-gradient(90deg, transparent 24%, var(--mat-grid) 25%, var(--mat-grid) 26%, transparent 27%, transparent 74%, var(--mat-grid) 75%, var(--mat-grid) 76%, transparent 77%),
      var(--mat);
    background-size: 40px 40px, 40px 40px, auto;
    box-shadow: inset 0 1px 0 rgba(255,255,255,.08), inset 0 -8px 22px rgba(0,0,0,.55);
    border: 2px solid rgba(255,255,255,.12);
  }

  /* Dice */
  .dice{display:grid; grid-template-columns:1fr 1fr; gap:22px; align-items:center; justify-items:center}
  .die{
    width: 150px; height: 150px; border-radius: 20px; position: relative;
    background: var(--die-face);
    border: 6px solid var(--die-border); /* ALWAYS thick outline */
    box-shadow: 0 18px 32px rgba(0,0,0,.65), 0 6px 10px rgba(0,0,0,.55);
    transition: transform .15s ease;
  }
  .die.spin{ animation: roll .38s cubic-bezier(.22,.61,.36,1) }
  @keyframes roll{
    0%{ transform: translateY(0) rotate(0) scale(1) }
    35%{ transform: translateY(-8px) rotate(10deg) scale(1.04) }
    70%{ transform: translateY(5px) rotate(-6deg) scale(1.02) }
    100%{ transform: translateY(0) rotate(0) scale(1) }
  }
  .die svg{width:100%; height:100%}
  .pip{ fill: var(--pip); stroke: var(--die-border); stroke-width: 3.2px }

  /* ----- Controls: single line, no scroll ----- */
  .controlsWrap{
    margin-top:12px;
    /* We will set an explicit height via JS so scaling doesn't collapse layout */
  }
  .controls{
    display:flex; align-items:center; gap:10px;
    flex-wrap: nowrap; overflow: hidden;  /* no wrap, no scroll */
    transform-origin: left center;        /* scale from the left */
  }
  .controls > *{ flex: 0 0 auto; }       /* prevent shrinking that causes wrap */

  .control{display:inline-flex; align-items:center; gap:.5rem; white-space:nowrap}

  button{
    appearance:none; border-radius:12px; padding:.6rem .9rem;
    border:1px solid var(--border); background:var(--accent); color:#0b0e1a;
    font-weight:700; cursor:pointer; box-shadow:var(--shadow)
  }
  button.ghost{background:transparent; color:inherit}

  select, input[type="number"]{
    font-size:1rem; line-height:1.2; white-space:nowrap;
    padding:.55rem .9rem; border-radius:12px;
    border:2px solid var(--ctrl-border); color:var(--ctrl-text); background:var(--ctrl-bg);
    box-shadow:inset 0 0 0 1px rgba(126,160,255,.15);
    appearance:none; -webkit-appearance:none; -moz-appearance:none;
  }
  select{
    background-image:
      linear-gradient(45deg, transparent 50%, var(--ctrl-text) 50%),
      linear-gradient(135deg, var(--ctrl-text) 50%, transparent 50%),
      linear-gradient(to right, transparent, transparent);
    background-position:
      calc(100% - 18px) calc(50% - 5px),
      calc(100% - 12px) calc(50% - 5px),
      calc(100% - 44px) 0;
    background-size: 6px 6px, 6px 6px, 1px 100%;
    background-repeat: no-repeat;
    padding-right: 2.4rem;
  }
  select option{ background:#0f1426; color:#f2f5ff; font-size:1rem; }
  select:focus-visible, input[type="number"]:focus-visible{ outline:3px solid var(--ctrl-focus); outline-offset:2px }
  select::-ms-expand{ display:none; }

  .panel{border:1px solid var(--border); border-radius:12px; padding:10px; background:rgba(16,22,44,.55)}
  .stats{display:grid; grid-template-columns:repeat(3, minmax(0,1fr)); gap:8px; text-align:center}
  .stat h3{margin:.1rem 0; color:var(--muted); font-size:.85rem}
  .stat p{margin:.1rem 0; font-weight:800; font-size:1.2rem}
  .log{max-height:240px; overflow:auto; border:1px solid var(--border); border-radius:12px; padding:8px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>Dice Game</h1>
      <div class="sub">Vanilla SPA • Forced dark • One line controls (no scroll)</div>
    </div>
    <nav aria-label="Primary">
      <a href="#/play" data-route>Play</a>
      <a href="#/stats" data-route>Stats</a>
      <a href="#/rules" data-route>Rules</a>
    </nav>
  </header>

  <main>
    <div id="live" aria-live="polite"></div>

    <section id="screen-play" class="screen">
      <div id="mat" class="mat">
        <div class="dice" aria-label="Dice">
          <div class="die" id="dieA" role="img" aria-label="Die A">
            <svg viewBox="0 0 100 100" aria-hidden="true">
              <g class="pips">
                <circle class="pip" cx="20" cy="20" r="9" data-pos="tl"/>
                <circle class="pip" cx="50" cy="20" r="9" data-pos="tc"/>
                <circle class="pip" cx="80" cy="20" r="9" data-pos="tr"/>
                <circle class="pip" cx="20" cy="50" r="9" data-pos="ml"/>
                <circle class="pip" cx="50" cy="50" r="9" data-pos="mc"/>
                <circle class="pip" cx="80" cy="50" r="9" data-pos="mr"/>
                <circle class="pip" cx="20" cy="80" r="9" data-pos="bl"/>
                <circle class="pip" cx="50" cy="80" r="9" data-pos="bc"/>
                <circle class="pip" cx="80" cy="80" r="9" data-pos="br"/>
              </g>
            </svg>
          </div>
          <div class="die" id="dieB" role="img" aria-label="Die B">
            <svg viewBox="0 0 100 100" aria-hidden="true">
              <g class="pips">
                <circle class="pip" cx="20" cy="20" r="9" data-pos="tl"/>
                <circle class="pip" cx="50" cy="20" r="9" data-pos="tc"/>
                <circle class="pip" cx="80" cy="20" r="9" data-pos="tr"/>
                <circle class="pip" cx="20" cy="50" r="9" data-pos="ml"/>
                <circle class="pip" cx="50" cy="50" r="9" data-pos="mc"/>
                <circle class="pip" cx="80" cy="50" r="9" data-pos="mr"/>
                <circle class="pip" cx="20" cy="80" r="9" data-pos="bl"/>
                <circle class="pip" cx="50" cy="80" r="9" data-pos="bc"/>
                <circle class="pip" cx="80" cy="80" r="9" data-pos="br"/>
              </g>
            </svg>
          </div>
        </div>
      </div>

      <!-- Single line, no scroll; auto-shrinks to fit -->
      <div class="controlsWrap">
        <div id="controls" class="controls">
          <button id="rollBtn">Roll</button>

          <label class="control">Target
            <input id="target" type="number" min="2" max="12" value="7" inputmode="numeric" />
          </label>

          <button id="resetRound" class="ghost">Clear Round</button>

          <label class="panel control">Mat
            <select id="matColor" aria-label="Mat color">
              <option value="#0a0f24" selected>Dark Navy</option>
              <option value="#004225">Green Felt</option>
              <option value="#3d0c02">Mahogany</option>
              <option value="#111111">Black</option>
              <option value="#2a2a2a">Dark Gray</option>
            </select>
          </label>

          <label class="panel control">Dice
            <select id="dieTheme" aria-label="Dice theme">
              <option value="darkWhite" selected>Dark Blue Face / White pips</option>
              <option value="black">Black Face / White pips</option>
              <option value="red">Red Face / White pips</option>
              <option value="white">White Face / Black pips</option>
              <option value="yellow">Yellow Face / Black pips</option>
            </select>
          </label>
        </div>
      </div>

      <div class="panel" style="margin-top:10px"><strong>Result:</strong> <span id="resultText">Click <b>Roll</b> to start.</span></div>

      <div class="panel" style="margin-top:10px">
        <div class="stats">
          <div class="stat"><h3>Rounds</h3><p id="statRounds">0</p></div>
          <div class="stat"><h3>Wins</h3><p id="statWins">0</p></div>
          <div class="stat"><h3>Win Rate</h3><p id="statRate">0%</p></div>
        </div>
      </div>

      <div class="panel" style="margin-top:10px">
        <button id="resetStats" class="ghost">Reset All Stats</button>
      </div>
    </section>

    <section id="screen-stats" class="screen">
      <h2 style="margin-top:0">Game Log</h2>
      <div class="log panel" style="background:transparent">
        <ul id="logList"></ul>
      </div>
      <p class="sub">Keeps last 50 rounds.</p>
    </section>

    <section id="screen-rules" class="screen">
      <h2 style="margin-top:0">Rules</h2>
      <ol>
        <li>Pick a target from 2–12.</li>
        <li>Click <b>Roll</b> to roll two dice.</li>
        <li>If the sum equals your target, you win the round.</li>
      </ol>
      <p class="sub">SPA: switching tabs doesn’t reload the page; JS updates the view.</p>
    </section>
  </main>
</div>

<script>
/* Router */
const routes = {"#/play":document.getElementById("screen-play"),"#/stats":document.getElementById("screen-stats"),"#/rules":document.getElementById("screen-rules")};
function setActiveNav(h){document.querySelectorAll("nav a[data-route]").forEach(a=>a.classList.toggle("active",a.getAttribute("href")=== (h||"#/play"))); }
function show(h){const r=routes[h]?h:"#/play"; Object.values(routes).forEach(el=>el.classList.remove("active")); routes[r].classList.add("active"); setActiveNav(r); if(r==="#/stats") renderLog();}
window.addEventListener("hashchange",()=>show(location.hash)); show(location.hash);

/* State */
const state={rounds:0,wins:0,log:[]}, KEY="dice_dark_noscroll_singleline_v1";
function save(){ localStorage.setItem(KEY, JSON.stringify({rounds:state.rounds,wins:state.wins,log:state.log})) }
(function(){ const raw=localStorage.getItem(KEY); if(!raw) return; try{ const s=JSON.parse(raw); state.rounds=s.rounds||0; state.wins=s.wins||0; state.log=Array.isArray(s.log)?s.log.slice(-50):[]; }catch{}})();

/* DOM */
const $=s=>document.querySelector(s);
const dieA=$("#dieA"), dieB=$("#dieB"), resultText=$("#resultText"), live=$("#live"), target=$("#target");
const statRounds=$("#statRounds"), statWins=$("#statWins"), statRate=$("#statRate");
const logList=$("#logList"), matEl=$("#mat"), matColor=$("#matColor"), dieTheme=$("#dieTheme");
const controls=$("#controls"), controlsWrap=document.querySelector(".controlsWrap");

/* Dice */
const FACE={1:["mc"],2:["tl","br"],3:["tl","mc","br"],4:["tl","tr","bl","br"],5:["tl","tr","mc","bl","br"],6:["tl","tr","ml","mr","bl","br"]};
function setDie(el,val){ el.querySelectorAll("[data-pos]").forEach(p=>p.style.display="none"); (FACE[val]||[]).forEach(pos=>{ const pip=el.querySelector(`[data-pos="${pos}"]`); if(pip) pip.style.display="block"; }); el.setAttribute("aria-label","Die shows "+val); }

/* Fit controls to one line without scroll (auto-scale) */
let baseHeight=null;
function fitControls(){
  // Reset scale first
  controls.style.transform = "scale(1)";
  const available = controlsWrap.clientWidth;
  const needed = controls.scrollWidth;
  const scale = Math.min(1, available / needed);
  controls.style.transform = `scale(${scale})`;
  const h = (baseHeight ?? controls.getBoundingClientRect().height);
  baseHeight = baseHeight ?? h;
  controlsWrap.style.height = (baseHeight * scale) + "px";
}
window.addEventListener("resize", fitControls);
new ResizeObserver(fitControls).observe(controlsWrap);

/* Appearance controls */
function setMat(color){ document.documentElement.style.setProperty("--mat", color); }
function setDieTheme(theme){
  const r=document.documentElement.style;
  if(theme==="darkWhite"){ r.setProperty("--die-face","#0c142c"); r.setProperty("--die-border","#fff"); r.setProperty("--pip","#fff"); }
  if(theme==="black"){ r.setProperty("--die-face","#000"); r.setProperty("--die-border","#fff"); r.setProperty("--pip","#fff"); }
  if(theme==="red"){ r.setProperty("--die-face","#cf0b0b"); r.setProperty("--die-border","#fff"); r.setProperty("--pip","#fff"); }
  if(theme==="white"){ r.setProperty("--die-face","#ffffff"); r.setProperty("--die-border","#000"); r.setProperty("--pip","#000"); }
  if(theme==="yellow"){ r.setProperty("--die-face","#ffd400"); r.setProperty("--die-border","#000"); r.setProperty("--pip","#000"); }
}

/* Game logic */
const d6=()=>Math.floor(Math.random()*6)+1, clamp=(n,a,b)=>Math.min(Math.max(n,a),b);
function updateStatsUI(){ const r=state.rounds||0, w=state.wins||0; statRounds.textContent=r; statWins.textContent=w; statRate.textContent=r?Math.round((w/r)*100)+"%":"0%"; }
function pushLog(e){ state.log.push(e); if(state.log.length>50) state.log.shift(); }
function renderLog(){ logList.innerHTML=""; const frag=document.createDocumentFragment(); [...state.log].reverse().forEach(e=>{ const li=document.createElement("li"); li.textContent=`#${e.round}: rolled ${e.a}+${e.b}=${e.total} — ${e.win?"WIN":"lose"} (target ${e.target})`; frag.appendChild(li); }); logList.appendChild(frag); }
async function animate(a,b){ dieA.classList.add("spin"); dieB.classList.add("spin"); await new Promise(r=>setTimeout(r,380)); dieA.classList.remove("spin"); dieB.classList.remove("spin"); setDie(dieA,a); setDie(dieB,b); }
async function roll(){ const a=d6(), b=d6(), total=a+b, tgt=clamp(parseInt(target.value,10)||7,2,12); state.rounds++; const win=(total===tgt); if(win) state.wins++; await animate(a,b); const msg=`You rolled ${total} (${a} + ${b}) — ${win?"WIN!":"try again"}`; resultText.innerHTML=msg; live.textContent=msg; pushLog({round:state.rounds,a,b,total,target:tgt,win}); updateStatsUI(); save(); }

/* Wire up */
$("#rollBtn").addEventListener("click", roll);
$("#resetRound").addEventListener("click", ()=>{ resultText.innerHTML="Round cleared. Click <b>Roll</b> to play."; live.textContent="Round cleared."; setDie(dieA,1); setDie(dieB,1); });
$("#resetStats").addEventListener("click", ()=>{ if(!confirm("Reset all stats and log?")) return; state.rounds=0; state.wins=0; state.log=[]; updateStatsUI(); renderLog(); save(); live.textContent="All stats reset."; });
matColor.addEventListener("change", e=> setMat(e.target.value));
dieTheme.addEventListener("change", e=> setDieTheme(e.target.value));

/* init */
setDie(dieA,1); setDie(dieB,1);
setMat(matColor.value); setDieTheme(dieTheme.value);
updateStatsUI();
fitControls();
</script>
</body>
</html>
